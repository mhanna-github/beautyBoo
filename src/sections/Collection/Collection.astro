---
import Image from '@components/Image/Image.astro';

const products = [
    {
        image: import('@images/product-1.png'),
        title: 'Mask',
        price: '54$',
        slug: 'hair-mask'
    },
    {
        image: import('@images/product-2.png'),
        title: 'Shampoo',
        price: '60$',
        slug: 'hair-shampoo'
    },
    {
        image: import('@images/product-3.png'),
        title: 'Balm',
        price: '49$',
        slug: 'hair-balm'
    },
    {
        image: import('@images/product-4.png'),
        title: 'Spray',
        price: '42$',
        slug: 'hair-spray'
    },
    {
        image: import('@images/product-1.png'),
        title: 'Gel',
        price: '58$',
        slug: 'hair-mask'
    },
    {
        image: import('@images/product-2.png'),
        title: 'Mask',
        price: '64$',
        slug: 'hair-shampoo'
    },
    {
        image: import('@images/product-2.png'),
        title: 'Foam',
        price: '52$',
        slug: 'hair-balm'
    },
    {
        image: import('@images/product-3.png'),
        title: 'Balm',
        price: '39$',
        slug: 'hair-spray'
    }
];
---

<header data-scroll-section>
    <div class="u-relative u-mt-[3vw]">
        <div class="u-container u-flex u-flex-col u-gap-gutter u-text-center">
            <h1 class="u-heading-h1 u-uppercase">Hair Care</h1>
            <p class="u-text-h3 u-uppercase">
                We`re taking a careful care of your hair on each step of washing hair routine
            </p>
        </div>
        <div class="swiper u-ml-[2.5vw] u-mt-[3vw] u-overflow-hidden" data-swiper>
            <ul class="swiper-wrapper">
                {
                    products.map((product, index) => (
                        <li class="swiper-slide" style="width: auto;">
                            <h3 class="u-text-h3">0{index + 1}</h3>
                            <a
                                class="u-mt-gutter u-flex u-cursor-pointer u-flex-col u-items-center u-gap-gutter"
                                href={`/products/${product.slug}`}
                            >
                                <figure class="u-hover-scale u-relative u-aspect-[264/622] u-w-[25vw] lg:u-w-[12vw]">
                                    <Image
                                        src={product.image}
                                        alt={product.title}
                                        class="u-absolute u-inset-0 u-grid u-h-full u-w-full u-place-items-end u-object-cover"
                                    />
                                </figure>
                                <span class="u-text-center">
                                    <h4 class="u-text-h4 u-uppercase">{product.title}</h4>
                                    <p class="u-text-h5">{product.price}</p>
                                </span>
                            </a>
                        </li>
                    ))
                }
            </ul>
        </div>
    </div>
</header>
<style>
    .swiper {
        position: relative;
        width: 100%;
        overflow: hidden;
    }
    .swiper-wrapper {
        position: relative;
        display: flex;
        width: 100%;
        height: 100%;
        z-index: 1;
        transition-property: transform;
    }
    .swiper-slide {
        margin-right: 10vw;
    }
</style>
<script>
    import 'swiper/css';
    import 'swiper/css/free-mode';
    import Swiper from 'swiper';
    import { FreeMode } from 'swiper/modules';
    import type { SwiperOptions } from 'swiper/types';

    let swiper: Swiper | null = null;

    function initSwiper(): void {
        console.log('Initializing Swiper...');
        requestAnimationFrame(() => {
            if (swiper && swiper.destroy) {
                console.log('Destroying old Swiper instance');
                swiper.destroy(true, true);
            }

            const swiperElement = document.querySelector('[data-swiper]');
            if (!swiperElement) {
                console.log('Swiper element not found');
                return;
            }

            console.log('Creating new Swiper instance');
            swiper = new Swiper('[data-swiper]', {
                slidesPerView: 'auto',
                spaceBetween: 0,
                freeMode: {
                    enabled: true,
                    momentum: true,
                    momentumRatio: 0.8
                },
                grabCursor: true,
                modules: [FreeMode],
                watchOverflow: true,
                touchReleaseOnEdges: true,
                cssMode: false,
                resistance: true,
                resistanceRatio: 0.85
            });
        });
    }

    // Create a mutation observer to watch for the swiper element
    const observer = new MutationObserver((mutations, obs) => {
        const swiperElement = document.querySelector('[data-swiper]');
        if (swiperElement) {
            console.log('Swiper element found by observer');
            initSwiper();
            // Don't disconnect the observer in case we need it again after navigation
        }
    });
    // Start observing
    observer.observe(document.body, {
        childList: true,
        subtree: true
    });
    // Initial load
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initSwiper);
    } else {
        initSwiper();
    }
    // Handle navigation events
    document.addEventListener('astro:after-swap', () => {
        console.log('astro:after-swap fired');
        // The observer will handle initialization when the element appears
    });
    // Cleanup before navigation
    document.addEventListener('astro:before-swap', () => {
        console.log('astro:before-swap fired');
        if (swiper && swiper.destroy) {
            swiper.destroy(true, true);
            swiper = null;
        }
    });
</script>
